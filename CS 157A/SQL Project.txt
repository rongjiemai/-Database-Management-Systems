
-- Step 1) Remove the old column from address
ALTER TABLE address
  DROP COLUMN phone;

-- Step 2) Strong entity: phone
--  - phone_id (PK, REQUIRED)
--  - country_code (REQUIRED)
--  - phone_number (REQUIRED)
--  - phone_type (optional)
CREATE TABLE phone (
  phone_id     INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  country_code INTEGER UNSIGNED NOT NULL,
  phone_number INTEGER UNSIGNED NOT NULL,
  phone_type   VARCHAR(12),
  PRIMARY KEY (phone_id)
) ENGINE=InnoDB;

-- Step 3) has-relationships (one-to-one, optional on both sides)
-- Add phone_id to each table, make the column UNIQUE, and add FK with
-- ON DELETE SET NULL and ON UPDATE CASCADE

ALTER TABLE customer
  ADD COLUMN phone_id INTEGER UNSIGNED NULL,
  ADD UNIQUE (phone_id),
  ADD FOREIGN KEY (phone_id)
    REFERENCES phone (phone_id)
    ON DELETE SET NULL
    ON UPDATE CASCADE;

ALTER TABLE staff
  ADD COLUMN phone_id INTEGER UNSIGNED NULL,
  ADD UNIQUE (phone_id),
  ADD FOREIGN KEY (phone_id)
    REFERENCES phone (phone_id)
    ON DELETE SET NULL
    ON UPDATE CASCADE;

ALTER TABLE store
  ADD COLUMN phone_id INTEGER UNSIGNED NULL,
  ADD UNIQUE (phone_id),
  ADD FOREIGN KEY (phone_id)
    REFERENCES phone (phone_id)
    ON DELETE SET NULL
    ON UPDATE CASCADE;

